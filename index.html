<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>丫亮校長的 Youtube 影片工具箱</title>
    <!-- ✅ 改為 Tailwind CDN 版本，適用 GitHub Pages / Netlify / Vercel -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./app.js"></script>
    <style>
        /* 美化 textarea 的外觀 */
        #srt-text-area { resize: none; overflow: auto; }
        /* 簡易替代 @tailwindcss/typography 的 .prose 外觀（CDN 版無外掛） */
        .prose h1 { font-size: 1.875rem; line-height: 2.25rem; font-weight: 700; }
        .prose h2 { font-size: 1.25rem; line-height: 1.75rem; font-weight: 700; margin-top: 1rem; margin-bottom: .5rem; }
        .prose p { margin: .5rem 0; }
        .prose hr { border: 0; border-top: 1px solid #e5e7eb; margin: 1rem 0; }
        .prose ul { list-style: disc; padding-left: 1.25rem; }
        .prose a { color: #2563eb; text-decoration: underline; }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div id="global-loading-overlay" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center hidden z-50">
        <div class="text-center">
            <svg class="animate-spin h-10 w-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-3 text-white font-semibold text-lg">AI 處理中，請稍候...</p>
        </div>
    </div>

    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-700">丫亮校長的 Youtube 影片工具箱 🛠️</h1>
            <button id="api-key-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                設定 API KEY
            </button>
        </div>
    </header>

    <main class="container mx-auto p-4 mt-4 space-y-6">
        
        <div class="flex border-b border-gray-300 mb-6">
            <button id="tab-subtitle-button" data-tab="subtitle" class="tab-button flex items-center px-8 py-3 text-xl font-semibold border-b-4 border-indigo-600 text-indigo-600 transition duration-300" style="margin-right: 1.25em;">
                 📝 字幕處理工具
            </button>
            <button id="tab-blog-button" data-tab="blog" class="tab-button flex items-center px-8 py-3 text-xl font-semibold border-b-4 border-transparent text-gray-500 hover:text-indigo-600 hover:border-indigo-600 transition duration-300">
                ✨ 內容產出工具
            </button>
        </div>
        
        <div id="subtitle-tab-content" class="tab-content w-full space-y-6">

            <section id="subtitle-processor-section" class="w-full bg-white p-6 rounded-lg shadow-lg flex flex-col relative">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">字幕來源</h2>
                
                <div id="srt-input-container">
                    <input type="file" id="srt-file-input" class="hidden" accept=".srt">

                    <textarea id="srt-text-area" class="w-full h-64 p-4 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-gray-50" placeholder="請在此貼上 SRT 內容，或將 .srt 檔案拖曳至此處"></textarea>

                    <p class="mt-3 text-center text-gray-600">
                        📥 貼上內容或拖曳檔案，也可以
                        <span id="srt-upload-link" class="text-indigo-600 hover:text-indigo-700 font-bold cursor-pointer underline">點擊此處上傳 .srt 檔案</span>
                    </p>
                </div>

                <div id="subtitle-content-wrapper" class="hidden space-y-4">
                    <div id="subtitle-preview-container">
                         <label class="block text-sm font-medium text-gray-700 mb-1">字幕預覽 (唯讀)</label>
                         <div id="subtitle-preview-area" class="w-full h-80 overflow-auto bg-gray-100 p-3 border rounded-md font-mono text-sm whitespace-pre-wrap">
                            <p class="text-gray-400 text-center mt-4">已載入的字幕將顯示於此...</p>
                         </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex flex-wrap items-center gap-x-6 gap-y-3 p-4 bg-gray-50 rounded-lg border">
                            
                            <div class="flex items-center space-x-2">
                                <label for="char-limit-input" class="text-sm font-medium text-gray-700 whitespace-nowrap">每行字數限制:</label>
                                <input type="number" id="char-limit-input" value="27" min="0" class="w-20 p-2 border border-gray-300 rounded-md text-center">
                                <span class="text-sm font-medium text-gray-700">字</span>
                            </div>

                            <div class="flex items-center space-x-2">
                                <label for="gap-threshold-input" class="text-sm font-medium text-gray-700 whitespace-nowrap">修復間隔 (毫秒):</label>
                                <input type="number" id="gap-threshold-input" value="100" min="0" class="w-20 p-2 border border-gray-300 rounded-md text-center">
                                <span class="text-sm font-medium text-gray-700">毫秒</span>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <label for="merge-threshold-input" class="text-sm font-medium text-gray-700 whitespace-nowrap">合併短行 (字數):</label>
                                <input type="number" id="merge-threshold-input" value="2" min="0" class="w-20 p-2 border border-gray-300 rounded-md text-center">
                                <span class="text-sm font-medium text-gray-700">字內</span>
                            </div>

                            <div class="flex items-center space-x-2">
                                <input id="remove-punctuation-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="remove-punctuation-checkbox" class="text-sm font-medium text-gray-700 whitespace-nowrap">移除所有標點符號</label>
                            </div>
                        </div>
                    </div>

                    <div class="border-t pt-4 flex flex-wrap justify-end gap-3">
                        <button id="process-subtitles-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-base">⚙️ 處理字幕</button>
                        <button id="batch-replace-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-base">批次取代...</button>
                        <button id="generate-chapters-button" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-base disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>▶️ 生成章節</button>
                        <button id="export-srt-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-base">📥 匯出檔案</button>
                        <button id="clear-content-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-base">🗑️ 清除內容</button>
                    </div>
                </div>
            </section>
        </div>

        <div id="blog-tab-content" class="tab-content w-full space-y-6 hidden">
            <section id="content-generation-section" class="w-full bg-white p-6 rounded-lg shadow-lg">
                 <h2 class="text-2xl font-bold mb-4 border-b pb-2">內容產出設定</h2>
                <div class="space-y-6">
                    <div id="blog-generation-section" class="bg-gray-50 p-4 rounded-lg relative border">
                        <h3 class="font-semibold text-lg mb-3">部落格文章生成器</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="space-y-3">
                                 <div>
                                    <label for="blog-title-input" class="block text-sm font-medium text-gray-700">文章主題 (必填)</label>
                                    <input type="text" id="blog-title-input" class="w-full p-2 border border-gray-300 rounded-md" placeholder="請輸入文章標題">
                                </div>
                                <div>
                                    <label for="youtube-id-input" class="block text-sm font-medium text-gray-700">YouTube 影片 ID (必填)</label>
                                    <input type="text" id="youtube-id-input" class="w-full p-2 border border-gray-300 rounded-md" placeholder="例如：dQw4w9WgXcQ">
                                </div>
                            </div>
                            <div class="space-y-3">
                                 <div>
                                    <label for="cta-preset-select" class="block text-sm font-medium text-gray-700">選擇宣傳語句範本</label>
                                    <select id="cta-preset-select" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="pupu">噗噗聊聊</option>
                                        <option value="izakaya">居酒屋微醺夜</option>
                                        <option value="custom">自訂 (下方編輯)</option>
                                    </select>
                                </div>
                                <div id="custom-cta-container">
                                    <label for="cta-input" class="block text-sm font-medium text-gray-700">自訂宣傳語 (將自動儲存)</label>
                                    <textarea id="cta-input" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="例如：喜歡這篇文章嗎？歡迎訂閱..."></textarea>
                                </div>
                            </div>
                        </div>
                        <button id="generate-blog-button" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 mb-4 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>✨ 生成文章與SEO建議</button>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="border-t pt-2">
                                 <div class="flex justify-between items-center mb-1">
                                    <h4 class="font-semibold text-md">成品預覽</h4>
                                    <button id="download-html-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-sm transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>下載HTML</button>
                                </div>
                                <div id="blog-preview-output" class="p-3 bg-white border rounded h-96 overflow-y-auto prose max-w-none">
                                    <p class="text-gray-400">文章成品將預覽於此...</p>
                                </div>
                            </div>
                             <div class="border-t pt-2">
                                 <h4 class="font-semibold text-md mb-1">SEO 建議</h4>
                                 <div class="space-y-2 p-3 bg-white border rounded h-96 overflow-y-auto">
                                    <div class="relative"><label class="block text-xs font-medium text-gray-500">SEO 標題</label><input type="text" id="seo-title-output" class="w-full p-2 pr-10 border border-gray-200 rounded-md bg-gray-50 text-sm" readonly><button id="copy-seo-title-button" class="absolute top-6 right-2 text-gray-400 hover:text-gray-600">📋</button></div>
                                    <div class="relative"><label class="block text-xs font-medium text-gray-500">固定網址 (Permalink)</label><input type="text" id="permalink-output" class="w-full p-2 pr-10 border border-gray-200 rounded-md bg-gray-50 text-sm" readonly><button id="copy-permalink-button" class="absolute top-6 right-2 text-gray-400 hover:text-gray-600">📋</button></div>
                                    <div class="relative"><label class="block text-xs font-medium text-gray-500">搜尋描述</label><textarea id="description-output" rows="4" class="w-full p-2 pr-10 border border-gray-200 rounded-md bg-gray-50 text-sm" readonly></textarea><button id="copy-description-button" class="absolute top-6 right-2 text-gray-400 hover:text-gray-600">📋</button></div>
                                    <div class="relative"><label class="block text-xs font-medium text-gray-500">標籤 (Labels)</label><input type="text" id="labels-output" class="w-full p-2 pr-10 border border-gray-200 rounded-md bg-gray-50 text-sm" readonly><button id="copy-labels-button" class="absolute top-6 right-2 text-gray-400 hover:text-gray-600">📋</button></div>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div id="api-key-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-20">
       <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4">請輸入您的 Gemini API KEY</h2>
            <p class="text-gray-600 mb-6">您的金鑰只會儲存在此瀏覽器分頁，關閉後即失效，我們不會儲存您的金鑰。</p>
            <input type="password" id="api-key-input" class="w-full p-2 border border-gray-300 rounded-lg mb-4" placeholder="在此貼上您的 API KEY">
            <div class="flex justify-end gap-4">
                <button id="cancel-api-key" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">取消</button>
                <button id="save-api-key" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">儲存</button>
            </div>
        </div>
    </div>
    <div id="replace-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-30">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-2xl flex flex-col">
            <h2 class="text-xl font-bold mb-4">設定批次取代規則</h2>
            <div id="replace-rules-container" class="space-y-2 mb-4 max-h-96 overflow-y-auto pr-2"></div>
            <div class="mb-4">
                <button id="add-rule-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg text-sm">+ 新增規則</button>
            </div>
            <div class="flex justify-end gap-4 border-t pt-4">
                <button id="cancel-replace-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">取消</button>
                <button id="apply-replace-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">套用取代</button>
            </div>
        </div>
    </div>
    <div id="chapters-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify中心 items-center z-40">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-lg flex flex-col">
            <h2 class="text-xl font-bold mb-4">影片章節生成結果</h2>
            <div id="chapters-modal-output" class="text-gray-800 p-4 bg-gray-100 border rounded h-64 overflow-y-auto whitespace-pre-wrap font-mono text-sm"></div>
            <div class="flex justify-end gap-4 border-t pt-4 mt-4">
                <button id="copy-chapters-modal-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">複製內容</button>
                <button id="close-chapters-modal-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">關閉</button>
            </div>
        </div>
    </div>
    <div id="report-modal" class="fixed inset-0 bg黑 bg-opacity-50 hidden flex justify-center items-center z-40">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-md flex flex-col">
            <h2 class="text-xl font-bold mb-4 text-indigo-700">⚙️ 字幕處理報告</h2>
            <div id="report-modal-output" class="text-gray-800 p-4 bg-gray-100 border rounded max-h-64 overflow-y-auto whitespace-pre-wrap font-mono text-sm"></div>
            <div class="flex justify-end gap-4 border-t pt-4 mt-4">
                <button id="close-report-modal-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">關閉</button>
            </div>
        </div>
    </div>
    <div id="replace-report-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-40">
        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-md flex flex-col">
            <h2 class="text-xl font-bold mb-4 text-green-700">✅ 批次取代已完成</h2>
            <div id="replace-report-modal-output" class="text-gray-800 text-lg font-semibold text-center py-4"></div>
            <div class="flex justify-end gap-4 border-t pt-4 mt-4">
                <button id="close-replace-report-modal-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">確定</button>
            </div>
        </div>
    </div>

</body>
</html>
